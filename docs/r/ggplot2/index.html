<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"><meta property="og:title" content="ggplot2" />
<meta property="og:description" content="ggplot2 ggplot2: Elegant Graphics for Data Analysis The R Graph Gallery 色々なグラフの例とコード 基本的な使い方 使い方の例 set.seed(7) data_df &lt;- data.frame( var1 = 1:10, var2 = rnorm(10), var3 = rep(LETTERS[1:3], length.out = 10)) ggplot(data = data_df) &#43; geom_point(aes(x = var1, y = var2, color = var3)) &#43; geom_line(aes(x = var1, y =" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://teuder.github.io/notebook/r/ggplot2/" /><meta property="article:section" content="R" />
<meta property="article:published_time" content="2019-09-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-12-07T21:56:34+09:00" />

<title>ggplot2 | notebook</title>
<link rel="icon" href="/notebook/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/notebook/book.min.2771458f1d859600effb70312702cd7e488eefb7c2c5ed4c083e65b6b95e5cae.css" integrity="sha256-J3FFjx2FlgDv&#43;3AxJwLNfkiO77fCxe1MCD5ltrleXK4=">


<script defer src="/notebook/search.min.b85637df922abffca4c9b24d079033c5b72ff94b157b0404dde8e7250ec0e893.js" integrity="sha256-uFY335Iqv/ykybJNB5Azxbcv&#43;UsVewQE3ejnJQ7A6JM="></script>

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://teuder.github.io/notebook/"><span>notebook</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" placeholder="Search" id="book-search-input" maxlength="64" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    

  






  <ul>
  
    

  <li >
    
      

  <a href="/notebook/docs/" >
      About
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/notebook/python/" >
      Python
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/notebook/python/poloars/" >
      polars
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/python/bigquery/" >
      BigQuery
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/python/environment/" >
      environment
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/python/jupyter/" >
      jupyter
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/python/pandas/" >
      Pandas
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/python/vscode/" >
      Python in VScode
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/python/anaconda/" >
      anaconda
  </a>

</li>
      
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/notebook/r/" >
      R
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/notebook/r/leaflet/" >
      leaflet
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/rhdf5/" >
      rhdf5
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/ggplot2/"  class="active">
      ggplot2
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/raster/" >
      raster
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/sf/" >
      sf
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/bigrquery/" >
      bigrquery
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/dplyr/" >
      dplyr
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/forcats/" >
      forcats
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/future/" >
      future
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/gganimate/" >
      gganimate
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/graph/" >
      graph
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/lubridate/" >
      lubridate
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/purrr/" >
      purrr
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/package_development/" >
      R Package Development
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/r_python/" >
      R_Python
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/reticulate/" >
      reticulate
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/rmarkdown/" >
      Rmarkdown
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/rpart/" >
      rpart
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/rstudio/" >
      RStudio
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/rstudio_server/" >
      Rstudio server
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/rvest/" >
      rvest
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/stars/" >
      stars
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/stringr/" >
      stringr
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/tidymodels/" >
      tidymodels
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/tidyr/" >
      tidyr
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/wk/" >
      wk
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/r/dbi/" >
      DBI
  </a>

</li>
      
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/notebook/llm/" >
      LLM: Large Language Models
  </a>


    

    




  
  <ul>
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/notebook/datascience/" >
      Data Science
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/notebook/datascience/bayesian_statistics/" >
      Bayesian Staistics
  </a>

</li>
      
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/notebook/gis/" >
      GIS &amp; Remote Sensing
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/notebook/gis/bigquerygis/" >
      BigQuery GIS
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/gis/sar/" >
      SAR
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/gis/terminology/" >
      用語
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/gis/viirs/" >
      VIIRS
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/gis/r_package/" >
      GIS関連Rパッケージ
  </a>

</li>
      
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/notebook/mac/" >
      Mac
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/notebook/mac/homebrew/" >
      homebrew
  </a>

</li>
      
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/notebook/maritime/" >
      Maritime
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/notebook/maritime/glossary/" >
      glossary
  </a>

</li>
      
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/notebook/gcp/" >
      Google Cloud Platform
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/notebook/gcp/bigquery_gis/" >
      BigQuery GIS
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/gcp/bigquery_bq/" >
      BigQuery: bqコマンド
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/gcp/bigquery/" >
      BigQuery: general
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/gcp/bigquery_sql/" >
      BigQuery: SQL
  </a>

</li>
      
    
  </ul>
  



  </li>


  
    

  <li >
    
      

  <a href="/notebook/miscellaneous/" >
      miscellaneous
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/notebook/miscellaneous/c_plus_plus/" >
      C&#43;&#43;
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/miscellaneous/english/" >
      english
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/miscellaneous/jinjia2/" >
      jinja
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/miscellaneous/jupyter/" >
      jupyter
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/miscellaneous/pc/" >
      PC
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/miscellaneous/tmux/" >
      tmux
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/miscellaneous/vscode/" >
      vscode
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/miscellaneous/windows/" >
      Windows
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/miscellaneous/wsl/" >
      wsl
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/miscellaneous/hugo/" >
      Hugo
  </a>

</li>
      
    
      
        <li>

  <a href="/notebook/miscellaneous/git/" >
      git
  </a>

</li>
      
    
  </ul>
  



  </li>


  
  </ul>











</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/notebook/svg/menu.svg" alt="Menu" />
  </label>
  <strong>ggplot2</strong>
</header>

      
<article class="markdown"><h1 id="ggplot2">ggplot2</h1>
<ul>
<li><a href="https://ggplot2-book.org/">ggplot2: Elegant Graphics for Data Analysis</a></li>
<li><a href="https://www.r-graph-gallery.com/index.html">The R Graph Gallery</a>
<ul>
<li>色々なグラフの例とコード</li>
</ul>
</li>
</ul>
<h1 id="基本的な使い方">基本的な使い方</h1>
<p>使い方の例</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">set.seed</span><span style="color:#111">(</span><span style="color:#ae81ff">7</span><span style="color:#111">)</span>
<span style="color:#111">data_df</span> <span style="color:#f92672">&lt;-</span> 
  <span style="color:#75af00">data.frame</span><span style="color:#111">(</span> <span style="color:#111">var1</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span><span style="color:#111">,</span>
              <span style="color:#111">var2</span> <span style="color:#f92672">=</span> <span style="color:#75af00">rnorm</span><span style="color:#111">(</span><span style="color:#ae81ff">10</span><span style="color:#111">),</span>
              <span style="color:#111">var3</span> <span style="color:#f92672">=</span> <span style="color:#75af00">rep</span><span style="color:#111">(</span><span style="color:#00a8c8">LETTERS</span><span style="color:#111">[1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span><span style="color:#111">]</span><span style="color:#111">,</span> <span style="color:#111">length.out</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span><span style="color:#111">))</span>

<span style="color:#75af00">ggplot</span><span style="color:#111">(</span><span style="color:#111">data</span> <span style="color:#f92672">=</span> <span style="color:#111">data_df</span><span style="color:#111">)</span> <span style="color:#f92672">+</span>
  <span style="color:#75af00">geom_point</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">var1</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">var2</span><span style="color:#111">,</span> <span style="color:#111">color</span> <span style="color:#f92672">=</span> <span style="color:#111">var3</span><span style="color:#111">))</span> <span style="color:#f92672">+</span>
  <span style="color:#75af00">geom_line</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">var1</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">var2</span><span style="color:#111">,</span> <span style="color:#111">color</span> <span style="color:#f92672">=</span> <span style="color:#111">var3</span><span style="color:#111">))</span>
</code></pre></div><p><code>ggplot()</code> 関数で <code>ggplot</code> オブジェクトを作成し、その <code>ggplot</code> オブジェクトに対して、 <code>+</code> 演算子を使って作図したいグラフの種類（<code>geom_*()</code> 関数）を指定する。 <code>geom_*()</code> 関数の中で <code>aes()</code> 関数を使って作図に使用する変数を指定する。</p>
<h2 id="ggplot">ggplot()</h2>
<pre tabindex="0"><code>ggplot(data = NULL, mapping = aes(), ...)
</code></pre><ul>
<li><code>data</code> : プロットしたいデータを含むデータフレームを渡す。データフレームは tidydata の形式になっていることが想定されている。</li>
<li><code>mapping</code> : 作図に使用する列名を <code>aes()</code> 関数を介して指定する。 例 : <code>aes(x = longitude, y = latitude, color = height, fill = height)</code></li>
</ul>
<h2 id="geom_">geom_*()</h2>
<p>グラフの種類ごとに <code>geom_*()</code> 関数が存在する</p>
<p>ちなみに <code>geom</code> は <code>geometry</code> （ジオメトリ）の略、グラフの基礎となる構造を指定する</p>
<pre tabindex="0"><code>geom_line()
geom_point()
</code></pre><h2 id="aes">aes()</h2>
<p><code>aes()</code> 関数は、 <code>ggplot()</code> や <code>geom_*()</code> の中で使う。具体的には <code>aes()</code> の出力を  <code>ggplot()</code> や <code>geom_*()</code> の　<code>mapping</code> 引数に渡す。基本的には  <code>geom_*()</code> 関数の中で使うのが一般的。</p>
<p><code>aes()</code> 関数は、散布図や折れ線などのグラフの座標（<code>x</code>, <code>y</code>）や線の色（<code>color</code>）、塗りつぶしの色（<code>fill</code>）、サイズ (<code>size</code>) などに <strong>「使用する列」</strong> を指定する。</p>
<p>ちなみに <code>aes</code>　は <code>aesthetic</code>（エステティック） の略、軸や色の指定に使用する変数を指定する</p>
<pre tabindex="0"><code># 都市の位置（ longitude, latitude）に点をプロット
# 都市名 (city) で色分け
# 点のサイズは人口 (population) に比例

data(data_df) +
 geom_point(aes(x = longitude, y = latitude, color = city, size = population)) 
</code></pre><h3 id="データのグループ分け">データのグループ分け</h3>
<p>例えば、 <code>geom_path()</code> などでグループごとに別々の線を書きたい場合などに使う</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">X</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">Y</span><span style="color:#111">,</span> <span style="color:#111">group</span> <span style="color:#f92672">=</span> <span style="color:#111">A</span><span style="color:#111">)</span>  <span style="color:#75715e"># 変数Aの値を使ってグループ分け</span>
<span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">X</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">Y</span><span style="color:#111">,</span> <span style="color:#111">group</span> <span style="color:#f92672">=</span> <span style="color:#75af00">interaction</span><span style="color:#111">(</span><span style="color:#111">A</span> <span style="color:#111">,</span> <span style="color:#111">B</span><span style="color:#111">))</span> <span style="color:#75715e"># 複数変数を使う場合</span>
</code></pre></div><h2 id="グラフの種類-geom_">グラフの種類: geom_*()</h2>
<p><code>geom</code> は <code>geometry</code> （ジオメトリ）の略、グラフの基礎となる構造を指定する</p>
<h3 id="散布図">散布図</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">geom_point</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#111">))</span>
</code></pre></div><h4 id="点の種類">点の種類</h4>
<p>shape</p>
<ul>
<li>
<p>color = 外部色　フチなし</p>
</li>
<li>
<p>1 丸, color 色指定 外部が塗りつぶされる</p>
</li>
<li>
<p>color = 縁の色 縁あり</p>
</li>
<li>
<p>19</p>
</li>
</ul>
<p>geom_point(aes(fill=id, size=id), colour=&ldquo;black&rdquo;, shape=21, stroke = 2)</p>
<h3 id="折れ線経路">折れ線・経路</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">geom_line</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#111">))</span>
<span style="color:#75af00">geom_path</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#111">))</span>
</code></pre></div><p><code>geom_line()</code> や <code>geom_path()</code> で <code>x</code> 軸に指定した変数が <code>factor</code> の場合は <code>aes(group=1)</code> を指定する。</p>
<h3 id="ヒストグラム密度分布">ヒストグラム・密度分布</h3>
<p>連続変数 x の値のビンごとの度数、頻度を、棒グラフ、曲線、折線で描画する</p>
<pre tabindex="0"><code>geom_histogram() # 棒グラフ（デフォルトは頻度分布）
geom_density()   # なめらかな曲線（デフォルトは密度文王）
geom_freqpoly()  # 折線（デフォルトは頻度）
</code></pre><h4 id="頻度分布と密度分布の切り替え">頻度分布と密度分布の切り替え</h4>
<p>いずれの <code>geom_*</code> でも、<code>aes()</code> の中で <code>y</code> を指定することで縦軸をカウント <code>..count..</code> 、密度（%） <code>..density..</code> のどちらにも対応できる</p>
<pre tabindex="0"><code>geom_histogram(aes(x, y = ..density..))
geom_density(  aes(x, y = ..count..  ))
</code></pre><h4 id="色分けした変数の位置">色分けした変数の位置</h4>
<pre tabindex="0"><code>position = &quot;identity&quot; # 重ね描き
position = &quot;stack&quot;    # 積み上げ
position = &quot;dodge&quot;`   # 隣接
position = &quot;fill&quot;     # 割合
</code></pre><h4 id="ビンの切り方-stat_bin">ビンの切り方: <code>stat_bin()</code></h4>
<p><code>stat_bin()</code> の <code>binwidth</code> から下の引数は <code>geom_*()</code> の中でも指定できる。</p>
<p>つまり、次の２つの書き方は等価</p>
<pre tabindex="0"><code>geom_histgram(aes(x), binwidth = 0.1)
geom_histgram(aes(x)) + stat_bin(binwidth = 0.1)
</code></pre><pre tabindex="0"><code>stat_bin(
  mapping = NULL,
  data = NULL,
  geom = &quot;bar&quot;,
  position = &quot;stack&quot;,
  ...,
  binwidth = NULL, # ビン幅
  bins = NULL,     # ビン数
  center = NULL,
  boundary = NULL,
  breaks = NULL,   # ビンの切れ目
  closed = c(&quot;right&quot;, &quot;left&quot;),
  pad = FALSE,
  na.rm = FALSE,
  orientation = NA,
  show.legend = NA,
  inherit.aes = TRUE
)
</code></pre><p><code>x</code> が離散変数なら <code>stat_count()</code> の方がいい</p>
<h4 id="連続変数の離散化">連続変数の離散化</h4>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># 変数 x を10個の等間隔のbinに切る</span>
<span style="color:#75af00">cut_interval</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#ae81ff">10</span><span style="color:#111">)</span>
</code></pre></div><h3 id="棒グラフ">棒グラフ</h3>
<p>1変数（カテゴリ変数）だけ指定すると、指定されたカテゴリ変数の値の数をそれぞれカウントした値が Y 軸になる。<code>stat = &quot;count&quot;</code> がデフォルトなので、暗黙に <code>stat_count()</code> が使用される。</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">ggplot</span><span style="color:#111">(</span><span style="color:#111">df</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> 
<span style="color:#75af00">geom_bar</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">category</span><span style="color:#111">))</span> 
<span style="color:#75715e"># 以下は上と同義</span>
<span style="color:#75715e">#geom_bar(aes(x = category), stat = &#34;count&#34;)</span>
</code></pre></div><p>X 軸（カテゴリ変数）と Y 軸（量的変数）の値を別々に指定する場合 <code>stat = &quot;identity&quot;</code></p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">ggplot</span><span style="color:#111">(</span><span style="color:#111">df</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> 
<span style="color:#75af00">geom_bar</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">category</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">value</span><span style="color:#111">),</span> <span style="color:#111">stat</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;identity&#34;</span><span style="color:#111">)</span>
</code></pre></div><p><code>stat = &quot;identity&quot;</code> は <code>geom_bar(aes(x = category, y = value)) + stat_identity()</code> と同じ意味になる？</p>
<p>棒の間に隙間を開けない時は <code>width = 1</code></p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">geom_bar</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">category</span><span style="color:#111">),</span> <span style="color:#111">width</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> 

</code></pre></div><h4 id="積み上げ棒グラフ">積み上げ棒グラフ</h4>
<p>X 軸（カテゴリ変数）と Y 軸（量的変数）のほかに、変数Z（カテゴリ変数）で色分けした積み上げ棒グラフ <code>aes(fill = z)</code></p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">ggplot</span><span style="color:#111">(</span><span style="color:#111">df</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> 
<span style="color:#75af00">geom_bar</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">category</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">value</span><span style="color:#111">,</span> <span style="color:#111">fill</span> <span style="color:#f92672">=</span> <span style="color:#111">category2</span><span style="color:#111">),</span> <span style="color:#111">stat</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;identity&#34;</span><span style="color:#111">)</span>
</code></pre></div><p>積み上げ棒グラフの縦軸を割合にする <code>position = &quot;fill&quot;</code></p>
<pre tabindex="0"><code>ggplot(df) + 
geom_bar(aes(x = category, y = value, fill = category2), stat = &quot;identity&quot;, position = &quot;fill&quot;) +
scale_y_continuous(labels = percent)
</code></pre><h4 id="棒の順序を変える">棒の順序を変える</h4>
<p>数が多い順に棒を並べ替えるなど。基本的には、予め、x軸（カテゴリ）ごとのy軸の値（カウントなど）を計算しておく必要がある。つまり、 <code>stat = &quot;identity&quot;</code> を指定するやり方が前提。</p>
<p>変数 y 軸の値を使って x 軸の順番を並べ替える。</p>
<pre tabindex="0"><code># 昇順の場合
ggplot(df, aes(x=reorder(x, y), y=y), stat = &quot;identity&quot;)

# 降順の場合
ggplot(df, aes(x=reorder(x, desc(y)), y=y), stat = &quot;identity&quot;)

</code></pre><p><code>reorder(x, y)</code> は基本的に <code>relevel()</code> の特殊なバージョン、つまり、変数 <code>x</code> を <code>factor</code> に変換し、その <code>level</code> の順序を 変数 <code>y</code> の値に戻づいて設定する。</p>
<h4 id="棒の向きを水平にする">棒の向きを水平にする</h4>
<p>横向きの棒グラフを作成するには最後に <code>coord_flip()</code> を付け加えるだけ</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">ggplot</span><span style="color:#111">(</span><span style="color:#111">df</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> 
<span style="color:#75af00">geom_bar</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">category</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">value</span><span style="color:#111">,</span> <span style="color:#111">fill</span> <span style="color:#f92672">=</span> <span style="color:#111">category2</span><span style="color:#111">),</span> <span style="color:#111">stat</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;identity&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">+</span>
<span style="color:#75af00">coord_flip</span><span style="color:#111">()</span>
</code></pre></div><h3 id="箱ひげ図バイオリンプロット">箱ひげ図・バイオリンプロット</h3>
<pre tabindex="0"><code>geom_violin(
  mapping = NULL,
  data = NULL,
  stat = &quot;ydensity&quot;,
  position = &quot;dodge&quot;,
  ...,
  draw_quantiles = NULL,
  trim = TRUE,
  scale = &quot;area&quot;,
  na.rm = FALSE,
  orientation = NA,
  show.legend = NA,
  inherit.aes = TRUE
)

</code></pre><h3 id="線分">線分</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># 垂直線</span>
<span style="color:#75af00">geom_vline</span><span style="color:#111">(</span><span style="color:#111">xintercept</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span><span style="color:#111">)</span>
<span style="color:#75715e"># 水平線</span>
<span style="color:#75af00">geom_hline</span><span style="color:#111">(</span><span style="color:#111">yintercept</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">110</span><span style="color:#111">)</span>
<span style="color:#75715e"># 傾いた線</span>
<span style="color:#75af00">geom_abline</span><span style="color:#111">(</span><span style="color:#111">intercept</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">37</span><span style="color:#111">,</span> <span style="color:#111">slope</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">-5</span><span style="color:#111">)</span><span style="color:#f92672">+</span>
</code></pre></div><p>linetype=&ldquo;dashed&rdquo;</p>
<h3 id="テキストラベル">テキストラベル</h3>
<pre tabindex="0"><code># 文字列
geom_text()
# Boxで囲まれた文字列
geom_label()

# 同じ
annotate(&quot;text&quot;, x = bbox[&quot;xmin&quot;], y = bbox[&quot;ymax&quot;], label = &quot;hoge&quot;, vjust=1, hjust=1) 
annotate(&quot;label&quot;, x = bbox[&quot;xmin&quot;], y = bbox[&quot;ymax&quot;], label = &quot;hoge, vjust=1, hjust=1)
</code></pre><div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#111">p</span> <span style="color:#f92672">&lt;-</span> <span style="color:#75af00">ggplot</span><span style="color:#111">(</span><span style="color:#111">mtcars</span><span style="color:#111">,</span> <span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">wt</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">mpg</span><span style="color:#111">))</span> <span style="color:#f92672">+</span> <span style="color:#75af00">geom_point</span><span style="color:#111">()</span>
<span style="color:#111">p</span> <span style="color:#f92672">+</span> <span style="color:#75af00">annotate</span><span style="color:#111">(</span><span style="color:#d88200">&#34;text&#34;</span><span style="color:#111">,</span> <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span><span style="color:#111">,</span> <span style="color:#111">label</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Some text&#34;</span><span style="color:#111">)</span>
<span style="color:#111">p</span> <span style="color:#f92672">+</span> <span style="color:#75af00">annotate</span><span style="color:#111">(</span><span style="color:#d88200">&#34;text&#34;</span><span style="color:#111">,</span> <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span><span style="color:#111">,</span> <span style="color:#111">label</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Some text&#34;</span><span style="color:#111">)</span>
<span style="color:#111">p</span> <span style="color:#f92672">+</span> <span style="color:#75af00">annotate</span><span style="color:#111">(</span><span style="color:#d88200">&#34;rect&#34;</span><span style="color:#111">,</span> <span style="color:#111">xmin</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span><span style="color:#111">,</span> <span style="color:#111">xmax</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">4.2</span><span style="color:#111">,</span> <span style="color:#111">ymin</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span><span style="color:#111">,</span> <span style="color:#111">ymax</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span><span style="color:#111">,</span>
  <span style="color:#111">alpha</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">.2</span><span style="color:#111">)</span>
<span style="color:#111">p</span> <span style="color:#f92672">+</span> <span style="color:#75af00">annotate</span><span style="color:#111">(</span><span style="color:#d88200">&#34;segment&#34;</span><span style="color:#111">,</span> <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.5</span><span style="color:#111">,</span> <span style="color:#111">xend</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span><span style="color:#111">,</span> <span style="color:#111">yend</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span><span style="color:#111">,</span>
  <span style="color:#111">colour</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;blue&#34;</span><span style="color:#111">)</span>
<span style="color:#111">p</span> <span style="color:#f92672">+</span> <span style="color:#75af00">annotate</span><span style="color:#111">(</span><span style="color:#d88200">&#34;pointrange&#34;</span><span style="color:#111">,</span> <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3.5</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span><span style="color:#111">,</span> <span style="color:#111">ymin</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span><span style="color:#111">,</span> <span style="color:#111">ymax</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">28</span><span style="color:#111">,</span>
  <span style="color:#111">colour</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;red&#34;</span><span style="color:#111">,</span> <span style="color:#111">size</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span><span style="color:#111">)</span>

<span style="color:#111">p</span> <span style="color:#f92672">+</span> <span style="color:#75af00">annotate</span><span style="color:#111">(</span><span style="color:#d88200">&#34;text&#34;</span><span style="color:#111">,</span> <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span><span style="color:#f92672">:</span><span style="color:#ae81ff">21</span><span style="color:#111">,</span> <span style="color:#111">label</span> <span style="color:#f92672">=</span> <span style="color:#75af00">c</span><span style="color:#111">(</span><span style="color:#d88200">&#34;my label&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;label 2&#34;</span><span style="color:#111">))</span>

<span style="color:#111">p</span> <span style="color:#f92672">+</span> <span style="color:#75af00">annotate</span><span style="color:#111">(</span><span style="color:#d88200">&#34;text&#34;</span><span style="color:#111">,</span> <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span><span style="color:#111">,</span> <span style="color:#111">label</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;italic(R) ^ 2 == 0.75&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">parse</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">TRUE</span><span style="color:#111">)</span>
<span style="color:#111">p</span> <span style="color:#f92672">+</span> <span style="color:#75af00">annotate</span><span style="color:#111">(</span><span style="color:#d88200">&#34;text&#34;</span><span style="color:#111">,</span> <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#111">,</span> <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span><span style="color:#111">,</span>
  <span style="color:#111">label</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;paste(italic(R) ^ 2, \&#34; = .75\&#34;)&#34;</span><span style="color:#111">,</span> <span style="color:#111">parse</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">TRUE</span><span style="color:#111">)</span>
</code></pre></div><h2 id="点の形">点の形</h2>
<p><code>geom_point()</code> の <code>shape</code> 引数に数値を指定することで点の形を指定する</p>
<p><img src="https://blog.albertkuo.me/post/2019-03-24-point-shapes-in-ggplot_files/figure-html/unnamed-chunk-2-1.png" alt="R shapes"></p>
<h2 id="色の指定">色の指定</h2>
<p>色分けに使用する変数は <code>aes()</code> の中で <code>aes(color = var1, fill = var2)</code> のように指定する。</p>
<p><code>color</code> （線や点の色）に対しては <code>scale_color_gradient()</code></p>
<p><code>fill</code> （塗りつぶし色）に対しては <code>scale_fill_gradient()</code></p>
<p>をそれぞれ使用する。</p>
<p>色もある種の軸であるので　scale_x_continuous() と同様に scale_color_continuous() や scale_fill_continuous() のように scale_*_()関数の一種として扱われている。</p>
<h3 id="色の種類">色の種類</h3>
<p><img src="https://derekogle.com/NCGraphing/img/colorbynames.png" alt="R colors in text"></p>
<h3 id="連続値に対する色つけ--scale__gradient">連続値に対する色つけ : <code>scale_*_gradient</code></h3>
<p>連続値: <code>integer</code>, <code>numeric</code></p>
<p><code>integer</code> は <code>factor</code> にしないと離散値とはみなされない</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">scale_colour_gradient</span><span style="color:#111">(</span><span style="color:#00a8c8">...</span><span style="color:#111">,</span> <span style="color:#111">low</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;#132B43&#34;</span><span style="color:#111">,</span> <span style="color:#111">high</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;#56B1F7&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">space</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Lab&#34;</span><span style="color:#111">,</span> <span style="color:#111">na.value</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;grey50&#34;</span><span style="color:#111">,</span> <span style="color:#111">guide</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;colourbar&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">aesthetics</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;colour&#34;</span><span style="color:#111">)</span>

<span style="color:#75af00">scale_fill_gradient</span><span style="color:#111">(</span><span style="color:#00a8c8">...</span><span style="color:#111">,</span> <span style="color:#111">low</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;#132B43&#34;</span><span style="color:#111">,</span> <span style="color:#111">high</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;#56B1F7&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">space</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Lab&#34;</span><span style="color:#111">,</span> <span style="color:#111">na.value</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;grey50&#34;</span><span style="color:#111">,</span> <span style="color:#111">guide</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;colourbar&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">aesthetics</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;fill&#34;</span><span style="color:#111">)</span>

<span style="color:#75af00">scale_colour_gradient2</span><span style="color:#111">(</span><span style="color:#00a8c8">...</span><span style="color:#111">,</span> <span style="color:#111">low</span> <span style="color:#f92672">=</span> <span style="color:#75af00">muted</span><span style="color:#111">(</span><span style="color:#d88200">&#34;red&#34;</span><span style="color:#111">),</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;white&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">high</span> <span style="color:#f92672">=</span> <span style="color:#75af00">muted</span><span style="color:#111">(</span><span style="color:#d88200">&#34;blue&#34;</span><span style="color:#111">),</span> <span style="color:#111">midpoint</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">space</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Lab&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">na.value</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;grey50&#34;</span><span style="color:#111">,</span> <span style="color:#111">guide</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;colourbar&#34;</span><span style="color:#111">,</span> <span style="color:#111">aesthetics</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;colour&#34;</span><span style="color:#111">)</span>

<span style="color:#75af00">scale_fill_gradient2</span><span style="color:#111">(</span><span style="color:#00a8c8">...</span><span style="color:#111">,</span> <span style="color:#111">low</span> <span style="color:#f92672">=</span> <span style="color:#75af00">muted</span><span style="color:#111">(</span><span style="color:#d88200">&#34;red&#34;</span><span style="color:#111">),</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;white&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">high</span> <span style="color:#f92672">=</span> <span style="color:#75af00">muted</span><span style="color:#111">(</span><span style="color:#d88200">&#34;blue&#34;</span><span style="color:#111">),</span> <span style="color:#111">midpoint</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">space</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Lab&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">na.value</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;grey50&#34;</span><span style="color:#111">,</span> <span style="color:#111">guide</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;colourbar&#34;</span><span style="color:#111">,</span> <span style="color:#111">aesthetics</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;fill&#34;</span><span style="color:#111">)</span>

<span style="color:#75af00">scale_colour_gradientn</span><span style="color:#111">(</span><span style="color:#00a8c8">...</span><span style="color:#111">,</span> <span style="color:#111">colours</span><span style="color:#111">,</span> <span style="color:#111">values</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">NULL</span><span style="color:#111">,</span> <span style="color:#111">space</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Lab&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">na.value</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;grey50&#34;</span><span style="color:#111">,</span> <span style="color:#111">guide</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;colourbar&#34;</span><span style="color:#111">,</span> <span style="color:#111">aesthetics</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;colour&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">colors</span><span style="color:#111">)</span>

<span style="color:#75af00">scale_fill_gradientn</span><span style="color:#111">(</span><span style="color:#00a8c8">...</span><span style="color:#111">,</span> <span style="color:#111">colours</span><span style="color:#111">,</span> <span style="color:#111">values</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">NULL</span><span style="color:#111">,</span> <span style="color:#111">space</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Lab&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">na.value</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;grey50&#34;</span><span style="color:#111">,</span> <span style="color:#111">guide</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;colourbar&#34;</span><span style="color:#111">,</span> <span style="color:#111">aesthetics</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;fill&#34;</span><span style="color:#111">,</span>
  <span style="color:#111">colors</span><span style="color:#111">)</span>
</code></pre></div><h3 id="離散値に対する色つけ">離散値に対する色つけ</h3>
<p>離散値: <code>character</code>, <code>factor</code></p>
<p><code>integer</code> は <code>factor</code> にしないと離散値とはみなされない</p>
<h3 id="レイヤーごとに異なる色の軸を指定する">レイヤーごとに異なる色の軸を指定する</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#111">ggnewscale</span><span style="color:#f92672">::</span><span style="color:#75af00">new_scale</span><span style="color:#111">(</span><span style="color:#d88200">&#34;color&#34;</span><span style="color:#111">)</span>
<span style="color:#111">ggnewscale</span><span style="color:#f92672">::</span><span style="color:#75af00">new_scale</span><span style="color:#111">(</span><span style="color:#d88200">&#34;fill&#34;</span><span style="color:#111">)</span>
<span style="color:#111">ggnewscale</span><span style="color:#f92672">::</span><span style="color:#75af00">new_scale_color</span><span style="color:#111">()</span>
<span style="color:#111">ggnewscale</span><span style="color:#f92672">::</span><span style="color:#75af00">new_scale_fill</span><span style="color:#111">()</span>
</code></pre></div><p>new_scale(new_aes)</p>
<p>new_scale_colour()</p>
<h2 id="タイトル">タイトル</h2>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">labs</span><span style="color:#111">(</span>
  <span style="color:#111">title</span> <span style="color:#f92672">=</span> <span style="color:#75af00">waiver</span><span style="color:#111">(),</span>    <span style="color:#75715e"># タイトル</span>
  <span style="color:#111">subtitle</span> <span style="color:#f92672">=</span> <span style="color:#75af00">waiver</span><span style="color:#111">(),</span> <span style="color:#75715e"># サブタイトル</span>
  <span style="color:#111">caption</span> <span style="color:#f92672">=</span> <span style="color:#75af00">waiver</span><span style="color:#111">(),</span>  <span style="color:#75715e"># キャプション、右下</span>
  <span style="color:#111">tag</span> <span style="color:#f92672">=</span> <span style="color:#75af00">waiver</span><span style="color:#111">()</span>       <span style="color:#75715e"># タグ、上左</span>
<span style="color:#111">)</span>
</code></pre></div><h3 id="タイトルとサブタイトル">タイトルとサブタイトル</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">ggtitle</span><span style="color:#111">(</span><span style="color:#111">label</span><span style="color:#111">,</span> <span style="color:#111">subtitle</span> <span style="color:#f92672">=</span> <span style="color:#75af00">waiver</span><span style="color:#111">())</span>
</code></pre></div><h2 id="軸のスケールや目盛の設定-scale_">軸のスケールや目盛の設定: scale_*()</h2>
<p>軸に対する様々な設定は <code>scale_軸_データ型()</code> 関数により行う。</p>
<ul>
<li>軸の種類： <code>x</code>, <code>y</code>, <code>color</code>, <code>fill</code>, <code>alpha</code>, <code>size</code>, <code>linetype</code>, <code>radius</code>, <code>shape</code></li>
<li>軸のデータ型: <code>condinuous</code>,<code>descrete</code>,<code>date</code>, <code>datetime</code>, <code>binned</code></li>
</ul>
<p><code>scale_軸_データ型()</code></p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#111">scale_[x</span><span style="color:#111">,</span><span style="color:#111">y</span><span style="color:#111">,</span><span style="color:#111">color</span><span style="color:#111">,</span><span style="color:#111">fill]_[condinuous</span><span style="color:#111">,</span><span style="color:#111">descrete</span><span style="color:#111">,</span><span style="color:#111">date</span><span style="color:#75af00">]</span><span style="color:#111">(</span>
  <span style="color:#111">breaks</span><span style="color:#f92672">=</span><span style="color:#75af00">c</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span><span style="color:#ae81ff">4</span><span style="color:#111">),</span> <span style="color:#75715e"># 目盛位置</span>
  <span style="color:#111">labels</span> <span style="color:#f92672">=</span> <span style="color:#75af00">c</span><span style="color:#111">(</span><span style="color:#d88200">&#34;01&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;02&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;03&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;04&#34;</span><span style="color:#111">),</span> <span style="color:#75715e"># 目盛に表示する値のラベル</span>
  <span style="color:#111">limits</span><span style="color:#f92672">=</span><span style="color:#75af00">c</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">120</span><span style="color:#111">),</span>   <span style="color:#75715e"># 表示する値の範囲</span>
  <span style="color:#75715e"># 表示する値の範囲を絞った時に、範囲外の値をどのように表示するか</span>
  <span style="color:#75715e"># oob = scales::censor, # NAに置換する</span>
  <span style="color:#75715e"># oob = scales::squish, # 範囲外の値に変換する</span>
  <span style="color:#75715e"># oob = scales::squish_infinite, # 無限値を範囲外の値に変換する</span>
  <span style="color:#111">oob</span> <span style="color:#f92672">=</span> <span style="color:#111">scales</span><span style="color:#f92672">::</span><span style="color:#75af00">censor</span><span style="color:#111">(),</span> 
  <span style="color:#111">trans</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;log10&#34;</span><span style="color:#111">,</span>   <span style="color:#75715e"># 軸のスケールを変換する関数 </span>
  <span style="color:#111">name</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;X axis&#34;</span><span style="color:#111">,</span>   <span style="color:#75715e"># 軸の名前</span>
  <span style="color:#111">guide</span> <span style="color:#f92672">=</span> <span style="color:#75af00">guide_axis</span><span style="color:#111">(</span><span style="color:#111">n.dodge</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#111">),</span> <span style="color:#75715e"># 目盛のラベルが重なっているときに位置をずらす</span>
  <span style="color:#111">expand</span> <span style="color:#f92672">=</span> <span style="color:#75af00">c</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span> <span style="color:#75715e"># x軸, y軸に対して、上下の隙間の大きさ、c(0,0)は隙間なし</span>
<span style="color:#111">)</span>
</code></pre></div><p><a href="https://qiita.com/nozma/items/2954b21e7136b3011580">geom_barやgeom_histgramでの軸の変換</a></p>
<h3 id="軸の名前">軸の名前</h3>
<p>X軸ラベル、Y軸ラベル</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">xlab</span><span style="color:#111">(</span><span style="color:#111">label</span><span style="color:#111">)</span>
<span style="color:#75af00">ylab</span><span style="color:#111">(</span><span style="color:#111">label</span><span style="color:#111">)</span>
</code></pre></div><h3 id="2軸グラフ">2軸グラフ</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Value used to transform the data</span>
<span style="color:#111">coeff</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">30</span>

<span style="color:#75af00">ggplot</span><span style="color:#111">(</span><span style="color:#111">count_df</span><span style="color:#111">,</span> <span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#f92672">=</span><span style="color:#111">date</span><span style="color:#111">))</span> <span style="color:#f92672">+</span>
  
  <span style="color:#75af00">geom_line</span><span style="color:#111">(</span> <span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">y</span><span style="color:#f92672">=</span><span style="color:#111">n_vessel</span><span style="color:#111">),</span> <span style="color:#111">color</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;red&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> 
  <span style="color:#75af00">geom_line</span><span style="color:#111">(</span> <span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">y</span><span style="color:#f92672">=</span><span style="color:#111">n_data</span> <span style="color:#f92672">/</span> <span style="color:#111">coeff</span><span style="color:#111">),</span> <span style="color:#111">color</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;blue&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#75715e"># Divide by 10 to get the same range than the temperature</span>
  
  <span style="color:#75af00">scale_y_continuous</span><span style="color:#111">(</span>

    <span style="color:#75715e"># Features of the first axis</span>
    <span style="color:#111">name</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;First Axis&#34;</span><span style="color:#111">,</span>

    <span style="color:#75715e"># Add a second axis and specify its features</span>
    <span style="color:#111">sec.axis</span> <span style="color:#f92672">=</span> <span style="color:#75af00">sec_axis</span><span style="color:#111">(</span><span style="color:#f92672">~</span><span style="color:#111">.*coeff</span><span style="color:#111">,</span> <span style="color:#111">name</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;Second Axis&#34;</span><span style="color:#111">)</span>
  <span style="color:#111">)</span>
</code></pre></div><h2 id="凡例">凡例</h2>
<h3 id="凡例を消す">凡例を消す</h3>
<p>特定の凡例（colour）を消す１</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">guides</span><span style="color:#111">(</span><span style="color:#111">colour</span><span style="color:#f92672">=</span><span style="color:#00a8c8">FALSE</span><span style="color:#111">)</span>
</code></pre></div><p>特定の凡例（colour）を消す２</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">scale_colour_discrete</span><span style="color:#111">(</span><span style="color:#111">guide</span><span style="color:#f92672">=</span><span style="color:#00a8c8">FALSE</span><span style="color:#111">)</span>
</code></pre></div><p>全ての凡例を消す</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">theme</span><span style="color:#111">(</span><span style="color:#111">legend.position</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#39;none&#39;</span><span style="color:#111">)</span>
</code></pre></div><p>凡例のタイトルを消す</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">theme</span><span style="color:#111">(</span><span style="color:#111">legend.title</span> <span style="color:#f92672">=</span> <span style="color:#75af00">element_blank</span><span style="color:#111">())</span>
</code></pre></div><h3 id="凡例の位置">凡例の位置</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># テキストで位置を指定</span>
<span style="color:#75715e"># &#34;none&#34;、&#34;left&#34;、&#34;right&#34;、&#34;bottom&#34;、&#34;top&#34;</span>
<span style="color:#75af00">theme</span><span style="color:#111">(</span><span style="color:#111">legend.position</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;right&#34;</span><span style="color:#111">)</span> <span style="color:#75715e"># 右</span>

<span style="color:#75715e"># 数値ベクトルc(x,y)で位置を指定</span>
<span style="color:#75af00">theme</span><span style="color:#111">(</span><span style="color:#111">legend.position</span><span style="color:#f92672">=</span><span style="color:#75af00">c</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">))</span> <span style="color:#75715e"># 左下</span>
<span style="color:#75af00">theme</span><span style="color:#111">(</span><span style="color:#111">legend.position</span><span style="color:#f92672">=</span><span style="color:#75af00">c</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">))</span> <span style="color:#75715e"># 右上</span>
<span style="color:#75af00">theme</span><span style="color:#111">(</span><span style="color:#111">legend.position</span><span style="color:#f92672">=</span><span style="color:#75af00">c</span><span style="color:#111">(</span><span style="color:#ae81ff">0.5</span><span style="color:#111">,</span><span style="color:#ae81ff">0.5</span><span style="color:#111">))</span> <span style="color:#75715e"># 中央</span>
</code></pre></div><h3 id="凡例の点のサイズ変更">凡例の点のサイズ変更</h3>
<p>デフォルトでは <code>geom_*()</code> で指定したサイズで凡例の点も表示されるが、点が小さい時には困る。凡例だけで大きいサイズでプロットしたい場合。</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">
<span style="color:#75af00">ggplot</span><span style="color:#111">()</span><span style="color:#f92672">+</span>

  <span style="color:#75715e"># guides() 関数の中で指定する場合</span>
  <span style="color:#75af00">guides</span><span style="color:#111">()(</span><span style="color:#111">color</span> <span style="color:#f92672">=</span> <span style="color:#75af00">guide_legend</span><span style="color:#111">(</span><span style="color:#111">override.aes</span> <span style="color:#f92672">=</span> <span style="color:#75af00">list</span><span style="color:#111">(</span><span style="color:#111">size</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span><span style="color:#111">)))</span><span style="color:#f92672">+</span>

  <span style="color:#75715e"># scale_*() 関数の中で指定する場合</span>
  <span style="color:#75af00">scale_fill_manual</span><span style="color:#111">(</span>
    <span style="color:#111">values</span> <span style="color:#f92672">=</span> <span style="color:#75af00">c</span><span style="color:#111">(</span>
      <span style="color:#d88200">&#34;A&#34;</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;blue&#34;</span><span style="color:#111">,</span>
      <span style="color:#d88200">&#34;B&#34;</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;cyan&#34;</span><span style="color:#111">,</span>
      <span style="color:#d88200">&#34;C&#34;</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;yellow&#34;</span>
    <span style="color:#111">),</span>
    <span style="color:#111">guide</span> <span style="color:#f92672">=</span> <span style="color:#75af00">guide_legend</span><span style="color:#111">(</span><span style="color:#111">override.aes</span> <span style="color:#f92672">=</span> <span style="color:#75af00">list</span><span style="color:#111">(</span><span style="color:#111">size</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span><span style="color:#111">))</span>
  <span style="color:#111">)</span> 
</code></pre></div><h3 id="凡例の名前変数名を変更する">凡例の名前（変数名）を変更する</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">labs</span><span style="color:#111">(</span><span style="color:#111">shape</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;Male/Female&#34;</span><span style="color:#111">,</span> <span style="color:#111">colour</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;Male/Female&#34;</span><span style="color:#111">)</span>
</code></pre></div><h2 id="画像として保存する--ggsave">画像として保存する : ggsave()</h2>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">gsave</span><span style="color:#111">(</span>
    <span style="color:#111">filename</span><span style="color:#111">,</span>
    <span style="color:#111">plot</span> <span style="color:#f92672">=</span> <span style="color:#75af00">last_plot</span><span style="color:#111">(),</span>
    <span style="color:#111">device</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">NULL</span><span style="color:#111">,</span>
    <span style="color:#111">path</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">NULL</span><span style="color:#111">,</span>
    <span style="color:#111">scale</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span>
    <span style="color:#111">width</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">NA</span><span style="color:#111">,</span>
    <span style="color:#111">height</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">NA</span><span style="color:#111">,</span>
    <span style="color:#111">units</span> <span style="color:#f92672">=</span> <span style="color:#75af00">c</span><span style="color:#111">(</span><span style="color:#d88200">&#34;in&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;cm&#34;</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;mm&#34;</span><span style="color:#111">),</span>
    <span style="color:#111">dpi</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span><span style="color:#111">,</span>
    <span style="color:#111">limitsize</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">TRUE</span><span style="color:#111">,</span>
     <span style="color:#00a8c8">...</span><span style="color:#111">)</span>
</code></pre></div><ul>
<li><code>filename</code> : ファイル名、拡張子で出力形式は自動で判別される</li>
<li><code>plot</code> : ggplotオブジェクト、デフォルトでは最後にプロットしたものが使われる</li>
<li><code>device</code> : 出力形式：&ldquo;eps&rdquo;, &ldquo;ps&rdquo;, &ldquo;tex&rdquo; (pictex), &ldquo;pdf&rdquo;, &ldquo;jpeg&rdquo;, &ldquo;tiff&rdquo;, &ldquo;png&rdquo;, &ldquo;bmp&rdquo;, &ldquo;svg&rdquo; or &ldquo;wmf&rdquo; (windows only)</li>
<li><code>path</code> : 保存先のパス filename と合体する</li>
<li><code>scale</code>	: 指定した出力サイズを scale 倍する</li>
<li><code>width</code> : 幅</li>
<li><code>height</code> : 高さ</li>
<li><code>units</code> : 幅と高さの単位 (&ldquo;in&rdquo;, &ldquo;cm&rdquo;, &ldquo;mm&rdquo;)</li>
<li><code>dpi</code> : ラスター画像の解像度 dot per inch、文字列でも指定できる &ldquo;retina&rdquo; (320), &ldquo;print&rdquo; (300), or &ldquo;screen&rdquo; (72)</li>
<li><code>limitsize</code> : TRUE だと 50x50インチより大きいサイズでプロットしない、エラーを防ぐため</li>
</ul>
<h2 id="テーマ">テーマ</h2>
<p>テーマの要素の色を変える</p>
<p>詳しくはこちら</p>
<p><a href="https://www.rdocumentation.org/packages/ggplot2/versions/3.3.2/topics/theme">https://www.rdocumentation.org/packages/ggplot2/versions/3.3.2/topics/theme</a></p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">
<span style="color:#111">color</span> <span style="color:#f92672">&lt;-</span> <span style="color:#d88200">&#34;black&#34;</span>

  <span style="color:#75af00">theme</span><span style="color:#111">(</span><span style="color:#75715e">#rect = element_rect(colour = color, fill = color),</span>
        <span style="color:#75715e">#text = element_text(color = &#34;white&#34;),</span>

        <span style="color:#75715e"># プロット領域の背景</span>
        <span style="color:#111">plot.background</span> <span style="color:#f92672">=</span> <span style="color:#75af00">element_rect</span><span style="color:#111">(</span><span style="color:#111">colour</span> <span style="color:#f92672">=</span> <span style="color:#111">color</span><span style="color:#111">,</span> <span style="color:#111">fill</span> <span style="color:#f92672">=</span> <span style="color:#111">color</span><span style="color:#111">),</span>

        <span style="color:#75715e"># パネル全体の背景</span>
        <span style="color:#111">panel.background</span> <span style="color:#f92672">=</span> <span style="color:#75af00">element_rect</span><span style="color:#111">(</span><span style="color:#111">colour</span> <span style="color:#f92672">=</span> <span style="color:#111">color</span><span style="color:#111">,</span> <span style="color:#111">fill</span> <span style="color:#f92672">=</span> <span style="color:#111">color</span><span style="color:#111">),</span>

        <span style="color:#75715e">#legend.key = element_rect(colour = color, fill = color),</span>
        <span style="color:#75715e">#panel.border = element_rect(fill = NA, colour = &#34;white&#34;, size = 1),</span>
        <span style="color:#75715e">#panel.grid.major = element_line(colour = &#34;grey60&#34;),</span>
        <span style="color:#75715e">#panel.grid.minor = element_line(colour = &#34;grey30&#34;),</span>
        
        <span style="color:#75715e">#axis.text = element_text(colour = &#34;white&#34;),</span>
  <span style="color:#111">)</span><span style="color:#f92672">+</span>
</code></pre></div><h2 id="複数のプロットを１つをまとめる">複数のプロットを１つをまとめる</h2>
<p><code>patchwork</code> パッケージを使うのが楽ちん</p>
<p><a href="https://qiita.com/nozma/items/4512623bea296ccb74ba">https://qiita.com/nozma/items/4512623bea296ccb74ba</a></p>
<p>基本的には <code>+</code> 演算子で複数の ggplot オブジェクトを1つにまとめる</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">library</span><span style="color:#111">(</span><span style="color:#111">ggplot2</span><span style="color:#111">)</span>
<span style="color:#75af00">library</span><span style="color:#111">(</span><span style="color:#111">patchwork</span><span style="color:#111">)</span>

<span style="color:#111">p1</span> <span style="color:#f92672">&lt;-</span> <span style="color:#75af00">ggplot</span><span style="color:#111">(</span><span style="color:#111">mtcars</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#75af00">geom_point</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">mpg</span><span style="color:#111">,</span> <span style="color:#111">disp</span><span style="color:#111">))</span>
<span style="color:#111">p2</span> <span style="color:#f92672">&lt;-</span> <span style="color:#75af00">ggplot</span><span style="color:#111">(</span><span style="color:#111">mtcars</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#75af00">geom_boxplot</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">gear</span><span style="color:#111">,</span> <span style="color:#111">disp</span><span style="color:#111">,</span> <span style="color:#111">group</span> <span style="color:#f92672">=</span> <span style="color:#111">gear</span><span style="color:#111">))</span>
<span style="color:#111">p1</span> <span style="color:#f92672">+</span> <span style="color:#111">p2</span>
</code></pre></div><p><code>p1 + p2</code> は <code>p1</code> と <code>p2</code> を左右に並べる</p>
<p><code>p1</code> と <code>p2</code>  を縦方向に並べるときは <code>plot_layout(ncol = 1)</code> を加える</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#111">p1</span> <span style="color:#f92672">+</span> <span style="color:#111">p2</span> <span style="color:#f92672">+</span> <span style="color:#75af00">plot_layout</span><span style="color:#111">(</span><span style="color:#111">ncol</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">heights</span> <span style="color:#f92672">=</span> <span style="color:#75af00">c</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">))</span>
</code></pre></div><p>間隔を開けたいときは <code>plot_spacer()</code></p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#111">p1</span> <span style="color:#f92672">+</span> <span style="color:#75af00">plot_spacer</span><span style="color:#111">()</span> <span style="color:#f92672">+</span> <span style="color:#111">p2</span>
</code></pre></div><p>複雑な構造を指定するときは <code>{}</code> を使用する</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># p1 は左、p2は右上、p3は右下</span>
<span style="color:#111">p1</span> <span style="color:#f92672">+</span> <span style="color:#111">{</span><span style="color:#111">p2</span> <span style="color:#f92672">+</span> <span style="color:#111">p3</span> <span style="color:#f92672">+</span> <span style="color:#75af00">plot_layout</span><span style="color:#111">(</span><span style="color:#111">ncol</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">)}</span>
</code></pre></div><p>図全体のタイトルや、サブ図ごとの図表番号などの指定</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#111">p1</span> <span style="color:#f92672">+</span> <span style="color:#111">p2</span> <span style="color:#f92672">+</span>

<span style="color:#75af00">plot_annotation</span><span style="color:#111">(</span>
    <span style="color:#111">title</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Title&#34;</span><span style="color:#111">,</span>
    <span style="color:#111">subtitle</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Subtitle&#34;</span><span style="color:#111">,</span>
    <span style="color:#111">caption</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;Caption&#34;</span><span style="color:#111">,</span>
    <span style="color:#111">tag_levels</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;A&#34;</span><span style="color:#111">,</span>
    <span style="color:#111">tag_prefix</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;fig &#34;</span><span style="color:#111">,</span>
    <span style="color:#111">tag_suffix</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;:&#34;</span>
  <span style="color:#111">)</span>
</code></pre></div><p>凡例が共通の時は1つにまとめることができる。</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#111">p1</span> <span style="color:#f92672">+</span> <span style="color:#111">p2</span> <span style="color:#f92672">+</span> <span style="color:#75af00">plot_layout</span><span style="color:#111">(</span><span style="color:#111">guides</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;collect&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&amp;</span>
<span style="color:#75715e"># さらに凡例の位置を下にする</span>
  <span style="color:#75af00">theme</span><span style="color:#111">(</span><span style="color:#111">legend.position</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;bottom&#39;</span><span style="color:#111">)</span>
</code></pre></div><h3 id="特定の変数の値を使って図を分離する">特定の変数の値を使って図を分離する</h3>
<p><code>facet_grid()</code> や  <code>facet_wrap()</code> を使う</p>
<p><code>facet_grid()</code> は図を2次元に配置する</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75af00">ggplot</span><span style="color:#111">(</span><span style="color:#111">diamonds</span><span style="color:#111">,</span> <span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#f92672">=</span><span style="color:#111">carat</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#f92672">=</span><span style="color:#111">price</span><span style="color:#111">))</span> <span style="color:#f92672">+</span>
  <span style="color:#75af00">geom_point</span><span style="color:#111">(</span><span style="color:#75af00">aes</span><span style="color:#111">(</span><span style="color:#111">colour</span><span style="color:#f92672">=</span><span style="color:#111">clarity</span><span style="color:#111">))</span> <span style="color:#f92672">+</span>
  <span style="color:#75af00">facet_grid</span><span style="color:#111">(</span><span style="color:#111">. </span><span style="color:#f92672">~</span> <span style="color:#111">color</span><span style="color:#111">)</span>   <span style="color:#75715e"># Horizontal 横に並べる</span>
  <span style="color:#75715e">#facet_grid(color ~ .)  # Vertical 縦に並べる</span>
</code></pre></div><h2 id="テキストボックスを追加する">テキストボックスを追加する</h2>
<p><a href="https://wilkelab.org/ggtext/reference/geom_textbox.html"><code>ggtext</code></a> パッケージを使うのが楽</p>
<pre tabindex="0"><code>library(ggtext)

gglot()+
  geom_textbox(aes(x, y, label, ))

</code></pre><p>引数</p>
<ul>
<li>nudge_x, nudge_y ボックスの位置座標からのオフセット</li>
<li>box.padding : 長さ4のベクトル、ボックス外の余白を指定  grid::unit(c(1,1,1,1), &ldquo;cm&rdquo;))</li>
<li>box.margin : 長さ4のベクトル、ボックス外の余白を指定</li>
<li>box.r : 長さ1のベクトル、ボックスの角の丸みを指定 grid::unit(c(1), &ldquo;cm&rdquo;))</li>
<li>width, height : 長さ1のベクトル、ボックスの幅と高さを指定 grid::unit(c(1), &ldquo;cm&rdquo;))</li>
<li>minwidth, maxwidth: ボックスの幅の最小最大値</li>
<li>minheight, maxheight: ボックスの高さの最小最大値</li>
</ul>
<p>aes()</p>
<ul>
<li>x : ボックス位置のx座標</li>
<li>y : ボックス位置のy座標</li>
<li>label : テキスト</li>
<li>colour : テキストとボックスの縁線の色</li>
<li>box.colour : ボックスの縁線の色</li>
<li>box.size  : ボックスの縁線の太さ</li>
<li>fill : ボックスの色</li>
<li>alpha : 透明度</li>
<li>halign ボックス外のテキストの水平位置 0なら左寄せ、1なら右寄せ</li>
<li>valign ボックス外のテキストの垂直位置 0なら下寄せ、1なら上寄せ</li>
<li>orientation : テキストの向き  &ldquo;upright&rdquo;, &ldquo;left-rotated&rdquo;, &ldquo;right-rotated&rdquo;, &ldquo;inverted&rdquo;.</li>
<li>hjust : 0ならボックスの左端を座標に合わせる、1なら右端を座標に合わせる</li>
<li>vjust : 0ならボックスの下端を座標に合わせる、1なら上端を座標に合わせる</li>
<li>text.colour : テキストの色</li>
<li>size : フォントサイズ</li>
<li>family : フォント</li>
<li>fontface : bold italic</li>
<li>lineheight : ?</li>
<li>group : ?</li>
</ul>
</article>

      
<div class="book-footer justify-between">
  
  <div>
    
    <a class="flex align-center" href="https://github.com/teuder/notebook/commit/75b80f33972ec714eeb762a543146c0a9fd4970a" title='Last modified 2022-12-07 by Masaki Tsuda' target="_blank" rel="noopener">
      <img src="/notebook/svg/calendar.svg" alt="Changed" />
      <span>2022-12-07</span>
    </a>
  </div>
  
  
  <div>
    
    <a class="flex align-center" href="https://github.com/teuder/notebook/edit/master/content/R/ggplot2.md" target="_blank" rel="noopener">
      <img src="/notebook/svg/edit.svg" alt="Edit" />
      <span>Edit this page</span>
    </a>
    
  </div>
  
</div>


      
    </div>

    
  

  <aside class="book-toc level-3 fixed">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#ggplot">ggplot()</a></li>
    <li><a href="#geom_">geom_*()</a></li>
    <li><a href="#aes">aes()</a>
      <ul>
        <li><a href="#データのグループ分け">データのグループ分け</a></li>
      </ul>
    </li>
    <li><a href="#グラフの種類-geom_">グラフの種類: geom_*()</a>
      <ul>
        <li><a href="#散布図">散布図</a></li>
        <li><a href="#折れ線経路">折れ線・経路</a></li>
        <li><a href="#ヒストグラム密度分布">ヒストグラム・密度分布</a></li>
        <li><a href="#棒グラフ">棒グラフ</a></li>
        <li><a href="#箱ひげ図バイオリンプロット">箱ひげ図・バイオリンプロット</a></li>
        <li><a href="#線分">線分</a></li>
        <li><a href="#テキストラベル">テキストラベル</a></li>
      </ul>
    </li>
    <li><a href="#点の形">点の形</a></li>
    <li><a href="#色の指定">色の指定</a>
      <ul>
        <li><a href="#色の種類">色の種類</a></li>
        <li><a href="#連続値に対する色つけ--scale__gradient">連続値に対する色つけ : <code>scale_*_gradient</code></a></li>
        <li><a href="#離散値に対する色つけ">離散値に対する色つけ</a></li>
        <li><a href="#レイヤーごとに異なる色の軸を指定する">レイヤーごとに異なる色の軸を指定する</a></li>
      </ul>
    </li>
    <li><a href="#タイトル">タイトル</a>
      <ul>
        <li><a href="#タイトルとサブタイトル">タイトルとサブタイトル</a></li>
      </ul>
    </li>
    <li><a href="#軸のスケールや目盛の設定-scale_">軸のスケールや目盛の設定: scale_*()</a>
      <ul>
        <li><a href="#軸の名前">軸の名前</a></li>
        <li><a href="#2軸グラフ">2軸グラフ</a></li>
      </ul>
    </li>
    <li><a href="#凡例">凡例</a>
      <ul>
        <li><a href="#凡例を消す">凡例を消す</a></li>
        <li><a href="#凡例の位置">凡例の位置</a></li>
        <li><a href="#凡例の点のサイズ変更">凡例の点のサイズ変更</a></li>
        <li><a href="#凡例の名前変数名を変更する">凡例の名前（変数名）を変更する</a></li>
      </ul>
    </li>
    <li><a href="#画像として保存する--ggsave">画像として保存する : ggsave()</a></li>
    <li><a href="#テーマ">テーマ</a></li>
    <li><a href="#複数のプロットを１つをまとめる">複数のプロットを１つをまとめる</a>
      <ul>
        <li><a href="#特定の変数の値を使って図を分離する">特定の変数の値を使って図を分離する</a></li>
      </ul>
    </li>
    <li><a href="#テキストボックスを追加する">テキストボックスを追加する</a></li>
  </ul>
</nav>
  </aside>



  </main>

  
</body>

</html>
